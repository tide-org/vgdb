---

buffers:
    vg_c_source:
        command: 'display_c_source'
        primary_window: true
        language: 'c'
        on_startup: true
        events:
            after_command:
                - command: 'set_piets'
                  input_args:
                      piet_match_array_variable: 'breakpoints'
                - command: 'set_c_highlight_line'
                  input_args:
                      highlight_line_variable: 'current_frame_address'

commands:
    display_c_source:
        steps:
            - run_config_command:
                name: 'list_breakpoints'
                buffer_name: 'vg_breakpoints'
                when: app_entrypoint != None
            - run_config_command:
                name: 'disassemble'
              when: no_program_counter == 0 and app_entrypoint != None
            - run_config_command:
                name: 'run_disassembly_in_range'
              when: no_program_counter == 1 and app_entrypoint != None
    disassemble:
        steps:
            - run_command:
                command: 'disassemble'
                buffer_name: 'vg_disassembly'
    stepi:
        steps:
            - run_command_with_match:
                command: 'stepi'
                match: '0x[0-9a-f]{2,16}'
                try_set: 'current_frame_address'
        update_buffers: true
    continue:
        steps:
            - run_command_with_match:
                command: 'continue'
                match: '0x[0-9a-f]{2,16}'
                try_set: 'current_frame_address'
        update_buffers: true
    run_user_command:
        steps:
            - run_command_string:
                variable_name: 'user_input_args'
