---

commands:
    load_file:
        steps:
            - run_command:
                command: 'file /Users/willvk/Source/wilvk/vgdb/tests/binaries/c_test/c_test'
    info_source:
        steps:
            - run_command:
                command: 'list'
            - run_command_with_match:
                command: 'info source'
                match: 'Located in (.*)\"$'
                match_group: 1
                try_set: 'current_filename'
            - print_debug:
                msg: "current_filename: {{ current_filename }}"
            - set_buffer:
                buffer_name: 'vg_code'
                file_name: "{{ current_filename }}"
            - run_command_with_match:
                command: 'backtrace'
                match: '\#0\s+.*\(\)\s.*:(\d+)'
                match_group: 1
                try_set: 'current_line_number'
    set_highlight_line:
        steps:
            - run_vim_function:
                function_name: 'buffer_breakpoint#set_highlight_line'
    set_breakpoint:
        steps:
            - run_command:
                command: 'b 6'
    run:
        steps:
            - run_command:
                command: 'run'
            - run_config_command:
                name: 'info_source'
    step:
        steps:
            - run_command:
                command: 'step'
            - run_config_command:
                name: 'info_source'
    set_highlight_for_breakpoint:
        steps:
            - run_vim_function:
                function_name: 'set_highlight#for_breakpoint_and_diff'

variables:
    current_filename: ''
    current_line_number: 0

events:
    after_startup:
        - 'load_file'
        - 'set_highlight_for_breakpoint'
        - 'info_source'

buffers:
    vg_session_log:
        on_startup: true
    vg_code:
        on_startup: true
        primary_window: true
        language: 'c'
        events:
            after_command:
                - command: 'set_highlight_line'
                  input_args:
                      highlight_line_variable: 'current_line_number'

settings:
    process:
        ttl_stream_timeout: 0.08
        main_process_name: 'gdb'
        main_process_default_arguments: ' -q --interpreter=mi2 '
        end_of_output_regex: '\(gdb\)'
