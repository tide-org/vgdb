---

buffers:
    vg_watchpoints:
        command: 'list_watchpoints'
    vg_registers:
        command: 'list_registers'
        on_startup: true
        diff:
            show_diff: true
            buffer_input_cache_variable: 'g:vg_registers_cache'
    vg_breakpoints:
        command: 'list_breakpoints'
    vg_session_log:
        scrolling_buffer: true
        on_startup: true

commands:
    disassemble:
        steps:
            - action: 'run_command'
              command: 'disassemble'
    list_breakpoints:
        steps:
            - action: 'run_command'
              command: 'info breakpoints'
    list_watchpoints:
        steps:
            - action: 'run_command'
              command: 'info watchpoints'
    list_registers:
        steps:
            - action: 'run_command'
              command: 'info registers'
    run_to_entrypoint:
        steps:
            - action: 'run_config_command'
              name: 'get_set_entrypoint'
            - action: 'create_interpolated_string'
              variable_name: 'breakpoint_command'
              value: 'break *{0}'
              args:
                - 'app_entrypoint'
            - action: 'run_command_string'
              variable_name: 'breakpoint_command'
            - action: 'run_command'
              command: 'continue'
            - action: 'run_vim_function'
              function_name: 'vgdb#functions#run_to_entrypoint#was_successful'
    get_set_entrypoint:
        steps:
            - action: 'run_command_with_match'
              command: 'info file'
              match: '(?<=Entry point: )0x[0-9a-f]{2,16}'
              try_set: 'app_entrypoint'
            - action: 'run_python_function'
              function_file: 'string_helpers.py'
              function_name: 'pad_hexadecimal_to_64bit'
              input_args:
                  hex_string: 'app_entrypoint'
              set_on_return: 'app_entrypoint'
    connect_to_remote:
        steps:
            - action: 'create_interpolated_string'
              variable_name: 'target_remote_command'
              value: 'target remote {0}'
              args:
                  - 'remote_address'
            - action: 'run_command_string'
              variable_name: 'target_remote_command'
    stepi:
        steps:
            - action: 'run_command_with_match'
              command: 'stepi'
              match: '0x[0-9a-f]{2,16}'
              try_set: 'current_frame_address'
        update_buffers: true
    continue:
        steps:
            - action: 'command_with_match'
              command: 'continue'
              match: '0x[0-9a-f]{2,16}'
              try_set: 'current_frame_address'
        update_buffers: true

variables:
    current_frame_address:
    app_entrypoint:
    binary_loaded: 0
    symbols_loaded: 0
    remote_target: 0
    remote_address: 'localhost:9999'
    connect_to_remote: 1

events:
    before_startup:
    after_startup:
       - 'connect_to_remote'
       - 'run_to_entrypoint'
    before_config_command:
    after_config_command:
    before_command:
    after_command:
    before_buffer_update:
    after_buffer_update:

settings:
    logging:
        use_session_log_file: true
        session_log_filename: 'vgdb_session.log'
        session_buffer_name: 'vg_session_log'
        buffer_input_variable: 'g:vg_full_query_result'
    buffers:
        default_input_buffer_variable: 'g:vg_query_result'
        base_filter: 'vg_base'
        load_on_start: 'vg_disassembly'
        stack_buffers_by_default: true
        stack_buffer_window_width: 60
    process:
        ttl_stream_timeout: 0.08
        run_command_on_startup: false
        command_to_run_on_startup: 'bin/dev-up'
        command_on_startup_log_file: 'vgdb_startup.log'
        main_process_name: 'gdb'
        main_process_default_arguments: ' -q --interpreter=mi2 '
        find_full_process_name: 'true'
        end_of_output_regex: '\(gdb\)'
    plugins:
        actions_path: "./plugins/actions"
        filters_path: "./plugins/filters"
        functions_path: "./plugins/functions"
